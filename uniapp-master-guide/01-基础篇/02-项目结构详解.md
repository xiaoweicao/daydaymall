# UniApp 项目结构详解

## 1. 标准项目结构

```
my-uniapp-project/
├── .hbuilderx/                 # HBuilderX 配置（如果使用）
├── dist/                       # 编译输出目录
│   ├── dev/                    # 开发环境
│   │   ├── mp-weixin/         # 微信小程序
│   │   └── h5/                # H5
│   └── build/                 # 生产环境
├── node_modules/              # 依赖包
├── public/                    # 静态资源（不会被编译）
├── src/                       # 源代码目录
│   ├── pages/                 # 页面文件
│   │   ├── index/
│   │   │   └── index.vue
│   │   └── user/
│   │       └── user.vue
│   ├── components/            # 组件
│   │   └── MyComponent.vue
│   ├── static/                # 静态资源（会被编译）
│   │   ├── images/
│   │   └── fonts/
│   ├── store/                 # 状态管理
│   │   └── index.ts
│   ├── utils/                 # 工具函数
│   │   ├── request.ts
│   │   └── common.ts
│   ├── api/                   # API 接口
│   │   └── user.ts
│   ├── styles/                # 全局样式
│   │   └── common.scss
│   ├── App.vue               # 应用入口
│   ├── main.ts               # 程序入口
│   ├── manifest.json         # 应用配置
│   ├── pages.json            # 页面路由配置
│   └── uni.scss              # uni-app 内置样式变量
├── .gitignore
├── index.html                # H5 入口
├── package.json
├── tsconfig.json             # TypeScript 配置
└── vite.config.ts            # Vite 配置
```

## 2. 核心文件详解

### 2.1 pages.json - 页面路由配置

这是 UniApp 最重要的配置文件，用于配置页面路径、窗口样式、底部导航等。

```json
{
  "pages": [
    {
      "path": "pages/index/index",
      "style": {
        "navigationBarTitleText": "首页",
        "navigationBarBackgroundColor": "#007AFF",
        "navigationBarTextStyle": "white",
        "enablePullDownRefresh": true
      }
    },
    {
      "path": "pages/category/category",
      "style": {
        "navigationBarTitleText": "分类"
      }
    },
    {
      "path": "pages/cart/cart",
      "style": {
        "navigationBarTitleText": "购物车"
      }
    },
    {
      "path": "pages/user/user",
      "style": {
        "navigationBarTitleText": "我的"
      }
    }
  ],
  "globalStyle": {
    "navigationBarTextStyle": "black",
    "navigationBarTitleText": "UniApp",
    "navigationBarBackgroundColor": "#F8F8F8",
    "backgroundColor": "#F8F8F8"
  },
  "tabBar": {
    "color": "#7A7E83",
    "selectedColor": "#007AFF",
    "borderStyle": "black",
    "backgroundColor": "#FFFFFF",
    "list": [
      {
        "pagePath": "pages/index/index",
        "iconPath": "static/tabbar/home.png",
        "selectedIconPath": "static/tabbar/home-active.png",
        "text": "首页"
      },
      {
        "pagePath": "pages/category/category",
        "iconPath": "static/tabbar/category.png",
        "selectedIconPath": "static/tabbar/category-active.png",
        "text": "分类"
      },
      {
        "pagePath": "pages/cart/cart",
        "iconPath": "static/tabbar/cart.png",
        "selectedIconPath": "static/tabbar/cart-active.png",
        "text": "购物车"
      },
      {
        "pagePath": "pages/user/user",
        "iconPath": "static/tabbar/user.png",
        "selectedIconPath": "static/tabbar/user-active.png",
        "text": "我的"
      }
    ]
  },
  "subPackages": [
    {
      "root": "pages-sub",
      "pages": [
        {
          "path": "detail/detail",
          "style": {
            "navigationBarTitleText": "商品详情"
          }
        }
      ]
    }
  ],
  "preloadRule": {
    "pages/index/index": {
      "network": "all",
      "packages": ["pages-sub"]
    }
  }
}
```

**重要配置说明：**

- `pages`: 页面路由数组，第一项为首页
- `globalStyle`: 全局样式配置
- `tabBar`: 底部导航栏配置
- `subPackages`: 分包配置（优化小程序体积）
- `preloadRule`: 分包预下载规则

### 2.2 manifest.json - 应用配置

应用的打包配置，包括应用名称、版本、权限等。

```json
{
  "name": "my-uniapp",
  "appid": "__UNI__XXXXXX",
  "description": "UniApp 应用描述",
  "versionName": "1.0.0",
  "versionCode": "100",
  "transformPx": false,
  
  /* 5+App 特有配置 */
  "app-plus": {
    "usingComponents": true,
    "nvueStyleCompiler": "uni-app",
    "compilerVersion": 3,
    "splashscreen": {
      "alwaysShowBeforeRender": true,
      "waiting": true,
      "autoclose": true,
      "delay": 0
    },
    "modules": {},
    "distribute": {
      "android": {
        "permissions": [
          "<uses-permission android:name=\"android.permission.INTERNET\"/>",
          "<uses-permission android:name=\"android.permission.CAMERA\"/>"
        ]
      },
      "ios": {},
      "sdkConfigs": {}
    }
  },
  
  /* 快应用特有配置 */
  "quickapp": {},
  
  /* 小程序特有配置 */
  "mp-weixin": {
    "appid": "wxXXXXXXXXXXXXXXXX",
    "setting": {
      "urlCheck": false,
      "es6": true,
      "minified": true
    },
    "usingComponents": true,
    "permission": {
      "scope.userLocation": {
        "desc": "你的位置信息将用于小程序定位"
      }
    }
  },
  "mp-alipay": {
    "usingComponents": true
  },
  "mp-baidu": {
    "usingComponents": true
  },
  
  /* H5 特有配置 */
  "h5": {
    "title": "UniApp H5",
    "domain": "https://www.example.com",
    "router": {
      "mode": "hash",
      "base": "/"
    },
    "optimization": {
      "treeShaking": {
        "enable": true
      }
    }
  }
}
```

### 2.3 App.vue - 应用入口

应用的生命周期和全局样式。

```vue
<script setup lang="ts">
import { onLaunch, onShow, onHide } from '@dcloudio/uni-app'

// 应用启动
onLaunch(() => {
  console.log('App Launch')
  
  // 检查更新
  checkUpdate()
  
  // 获取系统信息
  const systemInfo = uni.getSystemInfoSync()
  console.log('系统信息：', systemInfo)
})

// 应用显示
onShow(() => {
  console.log('App Show')
})

// 应用隐藏
onHide(() => {
  console.log('App Hide')
})

// 检查更新
const checkUpdate = () => {
  // #ifdef MP-WEIXIN
  const updateManager = uni.getUpdateManager()
  
  updateManager.onCheckForUpdate((res) => {
    console.log('是否有新版本：', res.hasUpdate)
  })
  
  updateManager.onUpdateReady(() => {
    uni.showModal({
      title: '更新提示',
      content: '新版本已经准备好，是否重启应用？',
      success: (res) => {
        if (res.confirm) {
          updateManager.applyUpdate()
        }
      }
    })
  })
  
  updateManager.onUpdateFailed(() => {
    uni.showToast({
      title: '新版本下载失败',
      icon: 'none'
    })
  })
  // #endif
}
</script>

<style lang="scss">
/* 全局样式 */
@import '@/styles/common.scss';

page {
  background-color: #f5f5f5;
  font-size: 28rpx;
}

/* 统一字体 */
* {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
}
</style>
```

### 2.4 main.ts - 程序入口

```typescript
import { createSSRApp } from 'vue'
import App from './App.vue'
import { setupStore } from './store'

export function createApp() {
  const app = createSSRApp(App)
  
  // 挂载状态管理
  setupStore(app)
  
  // 全局属性
  app.config.globalProperties.$apiUrl = 'https://api.example.com'
  
  return {
    app
  }
}
```

### 2.5 uni.scss - 样式变量

```scss
/* 颜色变量 */
$uni-color-primary: #007AFF;
$uni-color-success: #4cd964;
$uni-color-warning: #f0ad4e;
$uni-color-error: #dd524d;

/* 文字基本颜色 */
$uni-text-color: #333;
$uni-text-color-grey: #999;

/* 背景颜色 */
$uni-bg-color: #f5f5f5;
$uni-bg-color-hover: #f1f1f1;
$uni-bg-color-mask: rgba(0, 0, 0, 0.4);

/* 边框颜色 */
$uni-border-color: #e5e5e5;

/* 尺寸变量 */
$uni-spacing-row-lg: 30rpx;
$uni-spacing-row-base: 20rpx;
$uni-spacing-row-sm: 10rpx;

/* 字体大小 */
$uni-font-size-lg: 32rpx;
$uni-font-size-base: 28rpx;
$uni-font-size-sm: 24rpx;

/* 圆角 */
$uni-border-radius-lg: 12rpx;
$uni-border-radius-base: 6rpx;
$uni-border-radius-sm: 4rpx;
```

## 3. 页面文件结构

### 3.1 标准页面结构

```vue
<template>
  <view class="page">
    <view class="header">
      <!-- 页面头部 -->
    </view>
    
    <view class="content">
      <!-- 页面内容 -->
    </view>
    
    <view class="footer">
      <!-- 页面底部 -->
    </view>
  </view>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { onLoad, onShow, onReady, onPullDownRefresh } from '@dcloudio/uni-app'

// 响应式数据
const title = ref('页面标题')
const list = ref([])

// 页面加载
onLoad((options) => {
  console.log('页面参数：', options)
  loadData()
})

// 页面显示
onShow(() => {
  console.log('页面显示')
})

// 页面初次渲染完成
onReady(() => {
  console.log('页面渲染完成')
  uni.setNavigationBarTitle({
    title: title.value
  })
})

// 下拉刷新
onPullDownRefresh(() => {
  loadData().then(() => {
    uni.stopPullDownRefresh()
  })
})

// 加载数据
const loadData = async () => {
  try {
    // 数据请求逻辑
    list.value = []
  } catch (error) {
    console.error(error)
  }
}
</script>

<style lang="scss" scoped>
.page {
  min-height: 100vh;
  background-color: #f5f5f5;
}

.header {
  padding: 20rpx;
}

.content {
  flex: 1;
}

.footer {
  padding: 20rpx;
}
</style>
```

## 4. 目录组织最佳实践

### 4.1 按功能模块组织

```
src/
├── modules/
│   ├── user/                  # 用户模块
│   │   ├── pages/
│   │   ├── components/
│   │   ├── api/
│   │   └── store/
│   ├── product/              # 商品模块
│   │   ├── pages/
│   │   ├── components/
│   │   ├── api/
│   │   └── store/
│   └── order/                # 订单模块
```

### 4.2 按类型组织（推荐）

```
src/
├── api/                      # 所有 API
│   ├── user.ts
│   ├── product.ts
│   └── order.ts
├── components/               # 公共组件
│   ├── common/              # 通用组件
│   ├── business/            # 业务组件
│   └── layout/              # 布局组件
├── composables/             # 组合式函数
│   ├── useAuth.ts
│   └── useRequest.ts
├── pages/                   # 页面
├── store/                   # 状态管理
│   ├── modules/
│   │   ├── user.ts
│   │   └── cart.ts
│   └── index.ts
├── types/                   # TypeScript 类型
│   ├── user.d.ts
│   └── product.d.ts
└── utils/                   # 工具函数
    ├── request.ts
    ├── storage.ts
    └── validator.ts
```

## 5. 配置文件

### 5.1 vite.config.ts

```typescript
import { defineConfig } from 'vite'
import uni from '@dcloudio/vite-plugin-uni'
import { resolve } from 'path'

export default defineConfig({
  plugins: [uni()],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
      '@components': resolve(__dirname, 'src/components'),
      '@utils': resolve(__dirname, 'src/utils'),
      '@api': resolve(__dirname, 'src/api'),
      '@store': resolve(__dirname, 'src/store')
    }
  },
  server: {
    port: 5173,
    host: '0.0.0.0',
    proxy: {
      '/api': {
        target: 'https://api.example.com',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '')
      }
    }
  }
})
```

### 5.2 tsconfig.json

```json
{
  "compilerOptions": {
    "target": "esnext",
    "module": "esnext",
    "moduleResolution": "node",
    "strict": true,
    "jsx": "preserve",
    "sourceMap": true,
    "esModuleInterop": true,
    "lib": ["esnext", "dom"],
    "types": ["@dcloudio/types"],
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"],
      "@components/*": ["src/components/*"],
      "@utils/*": ["src/utils/*"],
      "@api/*": ["src/api/*"],
      "@store/*": ["src/store/*"]
    }
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist"]
}
```

## 6. 条件编译

UniApp 支持跨平台，使用条件编译处理平台差异：

```vue
<template>
  <view>
    <!-- #ifdef H5 -->
    <view>这是 H5 专属内容</view>
    <!-- #endif -->
    
    <!-- #ifdef MP-WEIXIN -->
    <view>这是微信小程序专属内容</view>
    <!-- #endif -->
    
    <!-- #ifdef APP-PLUS -->
    <view>这是 App 专属内容</view>
    <!-- #endif -->
  </view>
</template>

<script setup lang="ts">
// #ifdef H5
console.log('H5 平台')
// #endif

// #ifdef MP-WEIXIN
console.log('微信小程序平台')
// #endif

// #ifndef H5
console.log('非 H5 平台')
// #endif
</script>

<style>
/* #ifdef H5 */
.h5-only {
  color: red;
}
/* #endif */
</style>
```

**支持的平台标识：**
- `H5`: H5
- `MP-WEIXIN`: 微信小程序
- `MP-ALIPAY`: 支付宝小程序
- `MP-BAIDU`: 百度小程序
- `MP-TOUTIAO`: 字节跳动小程序
- `APP-PLUS`: App
- `APP-PLUS-NVUE`: App nvue 页面

## 7. 静态资源处理

### 7.1 图片资源

```vue
<template>
  <!-- 相对路径（推荐） -->
  <image src="@/static/logo.png" />
  
  <!-- 绝对路径 -->
  <image src="/static/logo.png" />
  
  <!-- 网络图片 -->
  <image src="https://example.com/image.png" />
  
  <!-- Base64 -->
  <image src="data:image/png;base64,..." />
</template>
```

### 7.2 字体文件

```scss
@font-face {
  font-family: 'CustomFont';
  src: url('@/static/fonts/custom.ttf') format('truetype');
}

.custom-text {
  font-family: 'CustomFont';
}
```

## 8. 总结

- `pages.json` - 页面路由和全局配置
- `manifest.json` - 应用打包配置
- `App.vue` - 应用生命周期
- `main.ts` - 程序入口
- `uni.scss` - 全局样式变量
- 合理组织目录结构
- 使用条件编译处理平台差异

下一步：学习基础组件的使用！
